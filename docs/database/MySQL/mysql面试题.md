<!-- TOC -->
<!-- - [1.说出几种索引失效的情况](#1.说出几种索引失效的情况)
- [2.如何优化数据导入](#2.如何优化数据导入)
- [3.优化分页查询](#3.优化分页查询)
- [4.优化count(*)](#4.优化count(*))
- [5.哪些情况需要添加索引](#5.哪些情况需要添加索引)
- [6.普通索引和唯一索引的区别](#6.普通索引和唯一索引的区别)
- [7.联合索引哪些情况不走索引](#7.联合索引哪些情况不走索引)
- [8.BTree索引和Hash索引的区别](#8.BTree索引和Hash索引的区别)
- [9.如何预防sql注入](#9.如何预防sql注入) -->
<!-- /TOC -->


## 13.锁的类型有哪些呢
mysql锁分为共享锁和排他锁，也叫做读锁和写锁。

读锁是共享的，可以通过lock in share mode实现，这时候只能读不能写。

写锁是排他的，它会阻塞其他的写锁和读锁。从颗粒度来区分，可以分为表锁和行锁两种。

表锁会锁定整张表并且阻塞其他用户对该表的所有读写操作，比如alter修改表结构的时候会锁表。

行锁又可以分为乐观锁和悲观锁，悲观锁可以通过for update实现，乐观锁则通过版本号实现。

## 15.ACID靠什么来保证呢
A原子性由undo log日志保证，它记录了需要回滚的日志信息，事务回滚时撤销已经执行成功的sql

C一致性一般由代码层面来保证

I隔离性由MVCC来保证

D持久性由内存+redo log来保证，mysql修改数据同时在内存和redo log记录这次操作，事务提交的时候通过redo log刷盘，宕机的时候可以从redo log恢复

## 16.什么是幻读，什么是MVCC

要说幻读，首先要了解MVCC，MVCC叫做多版本并发控制，实际上就是保存了数据在某个时间节点的快照。

我们每行数实际上隐藏了两列，创建时间版本号，过期(删除)时间版本号，每开始一个新的事务，版本号都会自动递增。

还是拿上面的user表举例子，假设我们插入两条数据，他们实际上应该长这样

## int(3)和int(11)的区别
varchar(m)，m表示字符长度，(注意不是字节长度！varchar(1)可以存储一个中文）。**但是int(m)，m不表示存储数字的长度！**

**int (3) 和 int (11) 占用的硬件存储空间完全相同**
首先，我们在申明某个字段数据类型为 int 的时候，不管是 int(3) 还是 int(11)，在 MySQL 中存储时都占用 4 个字节的长度。

1 个字节（Byte） = 8 个二进制位（bit），所以 1 个 int = 4 Byte = 4 * 8 bit = 32 bit，计算机中使用首个比特位存储数字符号（参考补码的定义），所以可以算出 int(m) 的存储范围在 [-2147483648，2147483647] 之间。

**int (3) 和 int (11) 在 zerofill 关键词修饰时展示不同**
我们可以创建一张测试表，并且插入一条数据
```sql
CREATE TABLE `test_int` (
  `id` int(11) NOT NULL PRIMARY KEY AUTO_INCREMENT,
  `num1` int(3)  zerofill,
  `num2` int(11)  zerofill
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

insert into test_int (num1, num2) values (1,1);
```

![](284c6b08-462b-4c9e-918a-7b57229bc194.png)

如上图所示，存储相同的数字 1，num1 前补全了 2 个 0，num2 前补全了 10 个 0，

所以可以得出结论：int(m) 中的 m 表示在 zerofill 修饰时，数字长度不足 m 时前缀补充的 0 的个数，除此之外，两者使用时没有任何区别。
